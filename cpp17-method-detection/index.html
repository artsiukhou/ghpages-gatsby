<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5f81339daa9828444137.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.24.91"/><title data-react-helmet="true">Refactoring with Modern(-ish) C++: Method Detection | Be Best Dev</title><meta data-react-helmet="true" name="description" content="You know that feeling when you&#x27;ve just read about some feature or tool and then you&#x27;re looking for a chance to use it?
I always wanted to…"/><meta data-react-helmet="true" name="og:image"/><meta data-react-helmet="true" name="og:image:alt" content="You know that feeling when you&#x27;ve just read about some feature or tool and then you&#x27;re looking for a chance to use it?
I always wanted to…"/><meta data-react-helmet="true" property="og:title" content="Refactoring with Modern(-ish) C++: Method Detection"/><meta data-react-helmet="true" property="og:description" content="You know that feeling when you&#x27;ve just read about some feature or tool and then you&#x27;re looking for a chance to use it?
I always wanted to…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:image"/><meta data-react-helmet="true" name="twitter:image:alt" content="You know that feeling when you&#x27;ve just read about some feature or tool and then you&#x27;re looking for a chance to use it?
I always wanted to…"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Vova Artsiukhou"/><meta data-react-helmet="true" name="twitter:title" content="Refactoring with Modern(-ish) C++: Method Detection"/><meta data-react-helmet="true" name="twitter:description" content="You know that feeling when you&#x27;ve just read about some feature or tool and then you&#x27;re looking for a chance to use it?
I always wanted to…"/><link as="script" rel="preload" href="/webpack-runtime-e6d7951fddc58f959674.js"/><link as="script" rel="preload" href="/styles-9411612e31e4f14527d1.js"/><link as="script" rel="preload" href="/framework-3e6dec6139dadaa7d0c7.js"/><link as="script" rel="preload" href="/app-1d30c51a5763fea8ff43.js"/><link as="script" rel="preload" href="/commons-f5374a954142fb1cdbec.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-d4b3e690a5efd4fbf1b8.js"/><link as="fetch" rel="preload" href="/page-data/cpp17-method-detection/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/416447326.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4198970465.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/764694655.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="y64jz7">body{--theme-ui-colors-text:var(--theme-ui-colors-text,#282c35);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#007acc);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#1B1F23);--theme-ui-colors-muted:var(--theme-ui-colors-muted,hsla(0,0%,0%,0.2));--theme-ui-colors-highlight:var(--theme-ui-colors-highlight,rgba(255,229,100,0.2));--theme-ui-colors-heading:var(--theme-ui-colors-heading,#282c35);--theme-ui-colors-prism-background:var(--theme-ui-colors-prism-background,#011627);--theme-ui-colors-prism-comment:var(--theme-ui-colors-prism-comment,#809393);--theme-ui-colors-prism-string:var(--theme-ui-colors-prism-string,#addb67);--theme-ui-colors-prism-var:var(--theme-ui-colors-prism-var,#d6deeb);--theme-ui-colors-prism-number:var(--theme-ui-colors-prism-number,#f78c6c);--theme-ui-colors-prism-constant:var(--theme-ui-colors-prism-constant,#82aaff);--theme-ui-colors-prism-punctuation:var(--theme-ui-colors-prism-punctuation,#c792ea);--theme-ui-colors-prism-className:var(--theme-ui-colors-prism-className,#ffc98b);--theme-ui-colors-prism-tag:var(--theme-ui-colors-prism-tag,#ffa7c4);--theme-ui-colors-prism-boolean:var(--theme-ui-colors-prism-boolean,#ff5874);--theme-ui-colors-prism-property:var(--theme-ui-colors-prism-property,#80cbc4);--theme-ui-colors-prism-namespace:var(--theme-ui-colors-prism-namespace,#b2ccd6);--theme-ui-colors-prism-highlight:var(--theme-ui-colors-prism-highlight,hsla(207,95%,15%,1));color:var(--theme-ui-colors-text,var(--theme-ui-colors-text,#282c35));background-color:var(--theme-ui-colors-background,var(--theme-ui-colors-background,#fff));}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,rgba(255,255,255,0.86));--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#232129);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#D9BAE8);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,rgba(255,255,255,0.86));--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,hsla(0,0%,100%,0.2));--theme-ui-colors-highlight:var(--theme-ui-colors-modes-dark-highlight,#663399);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="16mk19i">.css-16mk19i{font-family:'Merriweather','Georgia',serif;font-size:16px;font-weight:400;line-height:1.75;}</style><div class="css-16mk19i"><header><style data-emotion-css="nvo7eq">.css-nvo7eq{max-width:672px;margin-left:auto;margin-right:auto;padding-left:28px;padding-right:28px;padding-top:56px;}</style><div class="css-nvo7eq"><style data-emotion-css="2a1trj">.css-2a1trj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:56px;}</style><div class="css-2a1trj"><style data-emotion-css="1qd1r5f">.css-1qd1r5f{margin-top:0;margin-bottom:0;}</style><style data-emotion-css="9ngr65">.css-9ngr65{padding:0;margin:0;margin-bottom:28px;font-size:23.08319849451542px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;margin-top:0;margin-bottom:0;}</style><p class="css-9ngr65"><style data-emotion-css="wfvnhm">.css-wfvnhm{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;}.css-wfvnhm color{color:var(--theme-ui-colors-primary,#007acc);}</style><style data-emotion-css="1uuku5v">.css-1uuku5v{color:var(--theme-ui-colors-primary,#007acc);box-shadow:none;-webkit-text-decoration:none;text-decoration:none;}.css-1uuku5v color{color:var(--theme-ui-colors-primary,#007acc);}</style><a class="css-1uuku5v" href="/">Be Best Dev</a></p></div></div></header><div><style data-emotion-css="1ewmu01">.css-1ewmu01{max-width:672px;margin-left:auto;margin-right:auto;padding-left:28px;padding-right:28px;padding-top:56px;padding-bottom:56px;}</style><div class="css-1ewmu01"><main><style data-emotion-css="11b9pc1">.css-11b9pc1{padding:0;margin:0;margin-bottom:28px;font-size:40px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;}</style><h1 class="css-11b9pc1">Refactoring with Modern(-ish) C++: Method Detection</h1><style data-emotion-css="1qqxfhy">.css-1qqxfhy{font-size:13.32085131842997px;margin-top:-28px;margin-bottom:28px;}</style><style data-emotion-css="1m60b3c">.css-1m60b3c{padding:0;margin:0;margin-bottom:28px;font-size:13.32085131842997px;margin-top:-28px;margin-bottom:28px;}.css-1m60b3c code{font-size:inherit;}</style><p class="css-1m60b3c">April 10, 2021</p><style data-emotion-css="1mv7wyt">.css-1mv7wyt{padding:0;margin:0;margin-bottom:28px;}.css-1mv7wyt code{font-size:inherit;}</style><p class="css-1mv7wyt">You know that feeling when you’ve just read about some feature or tool and then you’re looking for a chance to use it?
I always wanted to try out some <em class="css-0">Modern C++</em> meta-template-magic items, and finally, I found a real use case for some
of them in one of the projects I’m working on. Well, sometimes one waits for too long, so worth saying that everything below
is suitable for C++17 (which I do consider <em class="css-0">Modern C++</em>), but in C++20 there are easier ways of achieving the same result.</p><p class="css-1mv7wyt"><em class="css-0">All the code from this post can be found on <style data-emotion-css="o7eq5i">.css-o7eq5i{color:var(--theme-ui-colors-primary,#007acc);}</style><a href="https://github.com/artsiukhou/blog_examples/tree/main/cpp-method-detection" class="css-o7eq5i">GitHub</a>.</em></p><p class="css-1mv7wyt">I’m refactoring a code in a file that is an entry point to our service.
It contains a lot (really, more than 80) autogenerated signatures of methods that are processing different requests
and there are plenty of common items that are copy-pasted between these methods.
For example, each response type has <style data-emotion-css="1pnz7gf">.css-1pnz7gf{border-radius:0.3em;color:var(--theme-ui-colors-secondary,#1B1F23);background-color:var(--theme-ui-colors-highlight,rgba(255,229,100,0.2));padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;}</style><code class="css-1pnz7gf">.status()</code> method to access field of type <code class="css-1pnz7gf">Status</code>:</p><style data-emotion-css="w0h414">.css-w0h414{padding:28px;margin:0;margin-bottom:14px;font-size:85%;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;color:white;background-color:var(--theme-ui-colors-prism-background,#011627);overflow:auto;border-radius:10px;}.css-w0h414 .attr-name{font-style:italic;}.css-w0h414 .comment{color:var(--theme-ui-colors-prism-comment,#809393);}.css-w0h414 .attr-name,.css-w0h414 .string,.css-w0h414 .url{color:var(--theme-ui-colors-prism-string,#addb67);}.css-w0h414 .variable{color:var(--theme-ui-colors-prism-var,#d6deeb);}.css-w0h414 .number{color:var(--theme-ui-colors-prism-number,#f78c6c);}.css-w0h414 .builtin,.css-w0h414 .char,.css-w0h414 .constant,.css-w0h414 .function{color:var(--theme-ui-colors-prism-constant,#82aaff);}.css-w0h414 .punctuation,.css-w0h414 .selector,.css-w0h414 .doctype{color:var(--theme-ui-colors-prism-punctuation,#c792ea);}.css-w0h414 .class-name{color:var(--theme-ui-colors-prism-className,#ffc98b);}.css-w0h414 .tag,.css-w0h414 .operator,.css-w0h414 .keyword{color:var(--theme-ui-colors-prism-tag,#ffa7c4);}.css-w0h414 .boolean{color:var(--theme-ui-colors-prism-boolean,#ff5874);}.css-w0h414 .property{color:var(--theme-ui-colors-prism-property,#80cbc4);}.css-w0h414 .namespace{color:var(--theme-ui-colors-prism-namespace,#b2ccd6);}</style><style data-emotion-css="1cd8nnu">.css-1cd8nnu{margin-bottom:14px;}</style><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token keyword css-1baulvz">class</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">Status</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">public</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    string</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> _result</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    string</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> _message</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">private</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    string _result</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    string _message</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">class</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">AnyResponse</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">public</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Status</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> _status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">private</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Status _status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span></div></pre></div><p class="css-1mv7wyt">So every request processing function looks like this:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">RespA </span><span class="token function css-1baulvz">entrypointToRequestA</span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> ReqA</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> reqA</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    RespA respA</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    respA</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    respA</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">try</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token function css-1baulvz">processReqA</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">reqA</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> respA</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">catch</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">exception</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        respA</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;FAIL&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        respA</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">what</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> respA</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">I want <em class="css-0">any</em> method to be as simple as:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">AnyResp </span><span class="token function css-1baulvz">entrypointToAnyRequest</span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> AnyReq</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> anyReq</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> genericProcessor</span><span class="token operator css-1baulvz">&lt;</span><span class="token plain css-1baulvz">AnyReq</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> AnyResp</span><span class="token operator css-1baulvz">&gt;</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">anyReq</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> processAnyReq</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">where <code class="css-1pnz7gf">genericProcessor&lt;ReqType, RespType&gt;()</code> is the following:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> Req</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> Resp</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> Processor</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">Resp </span><span class="token function css-1baulvz">genericProcessor</span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> Req</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> req</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> Processor</span><span class="token operator css-1baulvz">&amp;&amp;</span><span class="token plain css-1baulvz"> processorFunc</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Resp resp</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    resp</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    resp</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">try</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token function css-1baulvz">processorFunc</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">req</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> resp</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">catch</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">exception</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        resp</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;FAIL&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        resp</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">what</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> resp</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">Why? Well, it’s 1 line of code instead of 10 (and we have 80 more places like this, remember? reduce <a href="https://en.wikipedia.org/wiki/Software_entropy" class="css-o7eq5i">code entropy</a>!).
If it’s not enough: I can also modify just 1 method instead of 80 when I want to add, for example, some logs for each of the incoming requests;
or put something different to <code class="css-1pnz7gf">.result()</code> on different exception types; or collect common for each request metrics like <code class="css-1pnz7gf">processingTime</code>. And so on, and so on.</p><p class="css-1mv7wyt">But that’s simple, the code from above is already doing it! Uh, ok, I lied. For the reason unknown, some of the responses are just of type <code class="css-1pnz7gf">Status</code>.
“Historical reasons”, you know. So code there is:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">Status </span><span class="token function css-1baulvz">entrypointToRequestB</span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> ReqB</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> reqB</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Status status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    status</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    status</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">try</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token function css-1baulvz">processReqB</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">reqB</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> status</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">catch</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">exception</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        status</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;FAIL&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        status</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">what</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">Ok, easy-peasy, let’s introduce the following <code class="css-1pnz7gf">setStatus()</code> function:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">void</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">Status</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> status</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> string_view result</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> string_view message</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    status</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">result</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> result</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    status</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">message</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> message</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">And a templated version of it for any other type, which will even reuse the non-templated:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> T</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">void</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">T</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> resp</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> string_view result</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> string_view message</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">resp</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> result</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> message</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">Thanks to <a href="https://en.cppreference.com/w/cpp/language/overload_resolution" class="css-o7eq5i">function overloading</a>, this will work! So our <code class="css-1pnz7gf">genericProcessor()</code> now looks like:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> Req</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> Resp</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> Processor</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">Resp </span><span class="token function css-1baulvz">genericProcessor</span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> Req</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> req</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> Processor</span><span class="token operator css-1baulvz">&amp;&amp;</span><span class="token plain css-1baulvz"> processorFunc</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Resp resp</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">resp</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;SUCCESS&quot;</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">try</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token function css-1baulvz">processorFunc</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">req</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> resp</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">catch</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">exception</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">resp</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;FAIL&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> ex</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">what</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> resp</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">Nice! git add, git commit, git push! Wait… Ok, that’s not all.
For another set of historical reasons some of the responses don’t have anything like <code class="css-1pnz7gf">.status()</code> method at all, they are just responses:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">RespC </span><span class="token function css-1baulvz">entrypointToRequestC</span><span class="token punctuation css-1baulvz">(</span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> ReqC</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> reqC</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    RespC respC</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token function css-1baulvz">processReqC</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">reqC</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> respC</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> respC</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">So, we can’t use the <code class="css-1pnz7gf">genericProcessor()</code> as <code class="css-1pnz7gf">RespC</code> class doesn’t have <code class="css-1pnz7gf">.status()</code> method required in the <code class="css-1pnz7gf">setStatus()</code> helper.
But we still want to call it! We want all of our requests to be welcomed equally, have logs and metrics we will define in <code class="css-1pnz7gf">genericProcessor()</code>.
So, what if we will teach templated <code class="css-1pnz7gf">setStatus()</code> to know if the type has <code class="css-1pnz7gf">.status()</code> method, and if it’s not then it will be no-op?
Here <em class="css-0">Modern C++</em> comes in handy!</p><p class="css-1mv7wyt">How can we do this? To be honest, I don’t want to go too deep into details and rewrite many good StackOverflow responses and articles from the web because
I’m a) lazy b) lazy (choose your option). I’ll be focusing on the big picture and will provide links where you can learn more about how <em class="css-0">exactly</em> this works.</p><p class="css-1mv7wyt">To start with, we’re implementing a helper struct that helps us to detect if some type <code class="css-1pnz7gf">T</code> has <code class="css-1pnz7gf">.status()</code> method
(thanks, <a href="https://stackoverflow.com/questions/257288/templated-check-for-the-existence-of-a-class-member-function" class="css-o7eq5i">StackOverflow</a>).</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> T</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">void_t</span><span class="token operator css-1baulvz">&lt;</span><span class="token operator css-1baulvz">&gt;&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">struct</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">hasStatus</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">false_type </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> T</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">struct</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">hasStatus</span><span class="token operator css-1baulvz">&lt;</span><span class="token plain css-1baulvz">T</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">void_t</span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">decltype</span><span class="token punctuation css-1baulvz">(</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz">T</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">status</span><span class="token punctuation css-1baulvz">)</span><span class="token operator css-1baulvz">&gt;&gt;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">true_type </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span></div></pre></div><p class="css-1mv7wyt">The first struct is a templated struct to which any type will be resolved to and it indicates “no-status” types.
The second struct is a <a href="https://en.cppreference.com/w/cpp/language/partial_specialization" class="css-o7eq5i">partial specialization</a> of the first struct for types that have <code class="css-1pnz7gf">T::status</code> method.
The main feature here is that if <code class="css-1pnz7gf">T</code> doesn’t have this method, it’s not an error, thanks to <a href="https://en.cppreference.com/w/cpp/language/sfinae" class="css-o7eq5i">SFINAE</a>!
Both <code class="css-1pnz7gf">std::false_type</code> and <code class="css-1pnz7gf">std::true_type</code> structs provide a field <code class="css-1pnz7gf">constexpr static bool value</code> by which we can test the type.</p><p class="css-1mv7wyt">Ok, so now we can modify our <code class="css-1pnz7gf">.setStatus()</code>!</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> T</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">void</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">T</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> resp</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> string_view code</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> string_view message</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">if</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">constexpr</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">hasStatus</span><span class="token operator css-1baulvz">&lt;</span><span class="token plain css-1baulvz">T</span><span class="token operator css-1baulvz">&gt;</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">value</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token function css-1baulvz">setStatus</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">resp</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> code</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> message</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">else</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token comment css-1baulvz">/* no-op */</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">It compiles, it works on simple structures I’m using for tests.
With a great sense of joy, I copy-pasted our helpers to a real codebase… Added some tests… Ran them… And they… FAILED.</p><p class="css-1mv7wyt">What? How? Why? But it works on tests structs!? And there is no compile error, no warnings, it just produces not the result I want.
Well, requests with just <code class="css-1pnz7gf">Status</code> as response work well. At least something. Requests with no <code class="css-1pnz7gf">.status()</code> method in response work as well.
2 out of 3 already. So the issue is only with requests that have responses with <code class="css-1pnz7gf">.status()</code>.
Looking closer at the real responses and comparing them to the test structs I noticed that each response with <code class="css-1pnz7gf">.status()</code> method actually has 2 such methods:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">class</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">RealResponse</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">public</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Status</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> _status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> Status</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> _status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">private</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    Status _status</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span></div></pre></div><p class="css-1mv7wyt">Ok, adding the const method to our test struct. And indeed, <code class="css-1pnz7gf">hasStatus</code> doesn’t work any more! But why?
Let’s have a closer look at the <code class="css-1pnz7gf">hasStatus</code> definition:</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> T</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">struct</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">hasStatus</span><span class="token operator css-1baulvz">&lt;</span><span class="token plain css-1baulvz">T</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">void_t</span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">decltype</span><span class="token punctuation css-1baulvz">(</span><span class="token operator css-1baulvz">&amp;</span><span class="token plain css-1baulvz">T</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">status</span><span class="token punctuation css-1baulvz">)</span><span class="token operator css-1baulvz">&gt;&gt;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">true_type </span><span class="token punctuation css-1baulvz">{</span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span></div></pre></div><p class="css-1mv7wyt">It takes a return type of <code class="css-1pnz7gf">&amp;T::status</code>. If there is no <code class="css-1pnz7gf">.status()</code> it just skips this definition because of <em class="css-0">SFINAE</em>.
But if there are 2 different <code class="css-1pnz7gf">.status()</code> methods it <em class="css-0">doesn’t know</em> which type to take, so it skips it as well!
So for any type with 2 <code class="css-1pnz7gf">.status()</code> methods, this will never work! How this can be fixed?
Instead of checking the method existence on a type, we can instead invoke it on an object of this type by doing <code class="css-1pnz7gf">T().status()</code>, or better <code class="css-1pnz7gf">std::declval&lt;T&gt;().status()</code>!</p><div class="css-1cd8nnu"><pre class="language-cpp prism-code language-cpp css-w0h414"><div class="token-line"><span class="token keyword css-1baulvz">template</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">typename</span><span class="token plain css-1baulvz"> T</span><span class="token operator css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">struct</span><span class="token plain css-1baulvz"> </span><span class="token class-name css-1baulvz">hasStatus</span><span class="token operator css-1baulvz">&lt;</span><span class="token plain css-1baulvz">T</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">void_t</span><span class="token operator css-1baulvz">&lt;</span><span class="token keyword css-1baulvz">decltype</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">declval</span><span class="token operator css-1baulvz">&lt;</span><span class="token plain css-1baulvz">T</span><span class="token operator css-1baulvz">&gt;</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token operator css-1baulvz">::</span><span class="token function css-1baulvz">status</span><span class="token punctuation css-1baulvz">(</span><span class="token punctuation css-1baulvz">)</span><span class="token punctuation css-1baulvz">)</span><span class="token operator css-1baulvz">&gt;&gt;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> std</span><span class="token operator css-1baulvz">::</span><span class="token plain css-1baulvz">true_type </span><span class="token punctuation css-1baulvz">{</span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">;</span></div></pre></div><p class="css-1mv7wyt">Note that no real invocation happening here, this construction is kind of saying
<em class="css-0">“imagine that we have an object of type <code class="css-1pnz7gf">T</code> and we invoke <code class="css-1pnz7gf">.status()</code> and we get the resulting type”</em>.
And we don’t care about the resulting type itself, with <code class="css-1pnz7gf">void_t&lt;&gt;</code> it will be voided anyway.
What we care about is <em class="css-0">the whole construction</em> to be <em class="css-0">valid</em>, so the specialization will be selected.</p><p class="css-1mv7wyt">That’s all, folks!</p></main><style data-emotion-css="47xi18">.css-47xi18{margin-top:56px;padding-top:28px;}</style><footer class="css-47xi18"><style data-emotion-css="5rlcw3">.css-5rlcw3{padding:0;margin:0;margin-bottom:28px;border:0;border-bottom:1px solid;margin-top:-1px;border-color:var(--theme-ui-colors-muted,hsla(0,0%,0%,0.2));}</style><hr class="css-5rlcw3"/><style data-emotion-css="1hx7the">.css-1hx7the{margin-bottom:56px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="1kt7aet">.css-1kt7aet{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:56px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="xcwvoj">.css-xcwvoj{box-sizing:border-box;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:56px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-xcwvoj"><style data-emotion-css="14437zr">.css-14437zr{margin-right:14px;margin-bottom:0;width:48px;min-width:48px;border-radius:99999px;}</style><div class="css-14437zr gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:48px;height:48px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEDUlEQVQ4y22UWUxUVxjHeWuTJoBJERCU1tQuCZLY1sSHJk1fGlMVBmujgFNro2nRhgSqxEYNtdq4pKAgi+ybMAtSQDvIIjAMzLA47FvBwUChDJZF0UpTWX49984CWh9+Od8959z/t5zvHJd1mmBk1MF4axTyKOEpbFdtkBM3++guWL3Padt1XByGY8FbrcBDG4y/ag9RWfudRAqOCY5kh+Gn2S0c2vY6/3UK2j3ZolTImyMyQshNOkBTcjjNq2gV1Cd/S1qSktCcfXgLxz52UYeOiyPs9WJ87YaC0IwvMF79jjspEZTEhgn2r/BLGKVxSvSpUVQlfMNHebtxL1Lguyp1F4fhJbxtzA8kITOcmY5bTPaUY1SfxaQ550T6bim+yCOLnlHDdaLTvsRbJdV0pZ72CIPxLQwiIfUws+Yy+KsDrGaejbfILIy3yjwbs9lMmgXt/FGXR+S1UDw0K2nLgp726CrSovjbYmB54i6LQmjpz1YZrHdBzDm+pbVl4fBhVznJiQfxUAc9Lyil65e/i5sZkcxb6mG2x8aMbVwSYljbhN0r5rrta9086tRxOfkgr6sDnYfqFNxUoKA48QjTPVV0lSdxJ+sEDQUx1OScFGKtzA1UUJkejVH1E1Xpx7E0XMfaUkpcvNJWQ0eEUi95iY+ijnTyzh7i/c1vs+U9PwLe8cPXaw2fbPOnRptI7pVTfOi/kXVr3dga8Bb+m9bz8bbN1GSf5HxLLG4FO/DROAQFjV0aeDxAdMTXaDJiGWqrI/3qJbpMVXy1dydR4UoG2w3E/nyaeWs/P0YfJTXuNDy5R4opHtfCz/AVPSy3jSRaYkgBcYr328r5NT8ZTdYV1IKCaxfF6TYz0VVJTtJ5tNkJYj6e39RpTP1eC8ONXKg+h7tqpxC0R+gjlLcWK/mh5oxcrz5DEfrSLPRlWXRW57IkTvXpsJ4WXSb1N7OpLclkvE3H3FgDSl0kW26EyVk677IU6quF2wksC2dx2AhTog+nO4RQE3ODNcz0VTHbX83joVrZIdPtYk8n1r4K3tXuxU1E52O/2/YIbV0eUBRKZWsOjJtZEP22PGHmn1GjSFfHg97bcurS3KJoo+XRZlINl3lD87nzYXBGKIluEFG+UrCdiNsnYEQ07mSb3H8L940s3mtgYcjA4kgTS1KTP2jnyWAtn5YcxlW1Q87Qe3XKq3lTu4ckfSzLQoiZTsaK0jDHHKdNMFWnhYfdPBWHcazqFC/++/x7aPfgKa6RhyqQC7diWLI0yrWaHzbw74hU2y7meqs5VBwhn6rzPVQr/i/oWPCx257iFbmkO4PFpKXPpKLfpGbAqOJo6fesUe2SO+NFsZem7BBdqwlig1q0kyqED1T7BCEyXvLNUrxUTOI/IWYdB+Ns6csAAAAASUVORK5CYII=" alt="Vova Artsiukhou" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/ad6bee03c9500cd529cd6b3fedad5a42/aff39/avatar.png 1x,
/static/ad6bee03c9500cd529cd6b3fedad5a42/e5b88/avatar.png 1.5x,
/static/ad6bee03c9500cd529cd6b3fedad5a42/88b72/avatar.png 2x" /><img loading="lazy" width="48" height="48" srcset="/static/ad6bee03c9500cd529cd6b3fedad5a42/aff39/avatar.png 1x,
/static/ad6bee03c9500cd529cd6b3fedad5a42/e5b88/avatar.png 1.5x,
/static/ad6bee03c9500cd529cd6b3fedad5a42/88b72/avatar.png 2x" src="/static/ad6bee03c9500cd529cd6b3fedad5a42/aff39/avatar.png" alt="Vova Artsiukhou" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="css-0">Programming. Thoughts and stories. Tips and tricks.</div></div><style data-emotion-css="11r1i3o">.css-11r1i3o{-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;}</style><style data-emotion-css="1qfxf3w">.css-1qfxf3w{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;}</style><ul class="css-1qfxf3w"><li><a rel="prev" class="css-o7eq5i" href="/hello-world/">← <!-- -->Hello, World!</a></li><li><a rel="next" class="css-o7eq5i" href="/complexity-matters/">Complexity Matters?<!-- --> →</a></li></ul></footer></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/cpp17-method-detection/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-bd2fd6b0d1e6c7840162.js"],"app":["/app-1d30c51a5763fea8ff43.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-d4b3e690a5efd4fbf1b8.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js-1d70c13c9c227a3e2480.js"]};/*]]>*/</script><script src="/polyfill-bd2fd6b0d1e6c7840162.js" nomodule=""></script><script src="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-d4b3e690a5efd4fbf1b8.js" async=""></script><script src="/commons-f5374a954142fb1cdbec.js" async=""></script><script src="/app-1d30c51a5763fea8ff43.js" async=""></script><script src="/framework-3e6dec6139dadaa7d0c7.js" async=""></script><script src="/styles-9411612e31e4f14527d1.js" async=""></script><script src="/webpack-runtime-e6d7951fddc58f959674.js" async=""></script></body></html>